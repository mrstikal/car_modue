!function(){"use strict";function e(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const t={_storage:new WeakMap,put:function(e,t,o){this._storage.has(e)||this._storage.set(e,new Map),this._storage.get(e).set(t,o)},get:function(e,t){return this._storage.get(e).get(t)},has:function(e,t){return this._storage.has(e)&&this._storage.get(e).has(t)},remove:function(e,t){var o=this._storage.get(e).delete(t);return 0===!this._storage.get(e).size&&this._storage.delete(e),o}},o=function(e,t,o,r){let a;a="object"==typeof e?[document]:Array.from(document.querySelectorAll(e));let n=t.split(" ");if("function"==typeof o){let e=o;a.forEach((function(t){n.forEach((function(o){t.addEventListener(o,(function(o){e(t,o)}))}))}))}else a.forEach((function(e){n.forEach((function(t){e.addEventListener(t,(function(e){e.target.matches(o)&&r(e.target,e)}))}))}))},r=function(e,t="block"){Array.from(document.querySelectorAll(e)).forEach((function(e){e.style.display=t}))},a=function(e){Array.from(document.querySelectorAll(e)).forEach((function(e){e.style.display="none"}))};class n{constructor(){e(this,"mandatories",[]),e(this,"optionals",[]),e(this,"throwErrors",!0)}process(){let e=!1,o="",r=[],a=this.mandatories,n=this.optionals,i=this.throwErrors;if(a.length&&(r=Array.from(document.querySelectorAll(a)),r.forEach((function(t,r){if(t){let r=t.value;null==r&&(r=""),""==r.trim()&&(t.closest(".js_parent").querySelector(".this_element_name").classList.add("red_error"),t.classList.add("red_error"),e=!0,o+='<p>Je třeba vyplnit "'+t.closest(".js_parent").querySelector(".this_element_name").textContent+'"</p>')}})),e)){if(i){let e=document.querySelector(".general_error");e.querySelector(".error_is").innerHTML=o,e.style.display="block",TweenMax.to([document.documentElement,document.body],1,{scrollTop:c(document.querySelector(".red_error")).top})}return!1}n.length&&(r=r.concat(Array.from(document.querySelectorAll(n))));let s=new FormData;return r.forEach((function(e,o){if(e){let o=e.id,r=0;if(t.has(e,"Datepick")){let o=new Date(t.get(e,"Datepick").getDate("mm/dd/yyyy"));e.classList.contains("from")?(o.setHours(0,0,0,0),r=Math.ceil(o.getTime()/1e3)):e.classList.contains("to")?(o.setHours(23,59,59,999),r=Math.floor(o.getTime()/1e3)):(o.setHours(0,0,0,0),r=Math.ceil(o.getTime()/1e3))}else r=e.matches('[type="checkbox"]')?Number(e.checked):e.value.trim();s.append(o,r)}})),s}}const c=function(e){const t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}};class i extends Date{constructor(e){super(e),this.inputDate=e}addDays(e){var t=new Date(this.inputDate);return t.setDate(t.getDate()+e),t}}class s{constructor(e){return this.formData=new FormData,this.createFormData=function(e,t=""){for(let o in e){let r=e[o],a=t?t+"["+o+"]":o;"string"==typeof r||"number"==typeof r?this.formData.append(a,r):"object"==typeof r&&this.createFormData(r,a)}},this.createFormData(e),this.formData}}let l,d=1;function u(e,t){let o=new n;o.mandatories=["#car_id","#date_from","#date_to","#mileage","#use_rider","#lease_date_from","#lease_date_to"],o.throwErrors=e;let c=o.process();!1!==c&&(t&&r(".load_overlay"),fetch(calculate_price_ajax_url,{method:"POST",body:c,cache:"no-cache"}).then((e=>{if(!e.ok)throw new Error("Network response error");return e.json()})).then((e=>{a(".load_overlay"),document.querySelector("#price_visible").value=e.formatedPrice,document.querySelector("#price").value=e.roundePrice})).catch((function(e){console.log(e)})))}function p(){let e=new n;e.mandatories=["#car_id","#use_rider"];let t=e.process();r(".load_overlay"),fetch(bail_value_ajax_url,{method:"POST",body:t,cache:"no-cache"}).then((e=>{if(!e.ok)throw new Error("Network response error");return e.json()})).then((e=>{a(".load_overlay"),document.querySelector(".bail_value span").textContent=e.formated_price})).catch((function(e){console.log(e)}))}function f(e=!1){let t=new n;t.mandatories=["#car_id","#date_from","#date_to","#mileage","#email"],t.optionals=["#use_rider","#name","#phone","#phone","#status","#note","#price"];let o=t.process();!1!==o&&(o.append("id",id),o.append("redirect",Number(e)),r(".load_overlay"),fetch(save_booking_ajax_url,{method:"POST",body:o,cache:"no-cache"}).then((e=>{if(!e.ok)throw new Error(e.json());return e.redirected&&(window.location.href=e.url),e.json()})).then((t=>{e||(a(".load_overlay"),show_success.play(0))})).catch((function(e){console.log(e)})))}function m(e,t=!1){let o=new s(e);t?d++:d=1,r(".load_overlay"),fetch(load_ajax_url,{method:"POST",body:o,cache:"no-cache"}).then((e=>{if(!e.ok)throw console.log(e.json()),new Error("Network response error");return e.json()})).then((e=>{t?document.querySelector(".booking_table tbody").insertAdjacentHTML("afterend",e.html):document.querySelector(".booking_table tbody").innerHTML=e.html,e.can_load_more?r(".load_more_records","inline-block"):a(".load_more_records"),a(".load_overlay"),l()})).catch((function(e){console.log(e)}))}document.addEventListener("DOMContentLoaded",(function(e){if("undefined"!=typeof pagetype&&"bookings index"==pagetype){const e={placement:"top",html:!0,delay:{show:700,hide:0},offset:"0, 1"},n=new Map([[".admin_ico.admin_edit","Upravit záznam"],[".admin_ico.admin_delete","Smazat záznam"],[".admin_ico.admin_order_exists","Objednávku nelze vytvořit.<br>Objednávka již existuje nebo rezervace byla stornována"],[".admin_ico.admin_add_order","Vytvořit objednávku z této rezevace"],[".admin_ico.admin_decline","Stornovat rezervaci"],[".admin_ico.admin_refresh","Obnovit stornovanou rezervaci"]]);l=function(){!function(e,t){e.forEach((function(e,o){Array.from(document.querySelectorAll(o)).forEach((function(o,r){t.title=e,new Tooltip(o,t)}))}))}(n,e)},l(),Array.from(document.querySelectorAll(".select_type")).forEach((e=>{let o=e.id,r=new vanillaSelectBox("#"+o,{maxSelect:1});r.disableItems(["0"]),t.put(e,"vanillaSelectBox",r)})),Array.from(document.querySelectorAll(".datetime_picker")).forEach((e=>{let o=new Datepick(e,{language:"cs",autohide:!0});t.put(e,"Datepick",o)})),m({filters:{},page:1},!1),o(".reset_filters","click",(function(e){let o=e.closest(".data_processors_content");Array.from(o.querySelectorAll("input, select")).forEach((function(e){e.value="",e.dispatchEvent(new Event("change"))})),Array.from(o.querySelectorAll(".select_type")).forEach((function(e){t.get(e,"vanillaSelectBox").setValue("0")})),document.querySelector(".use_filters").dispatchEvent(new Event("click"))})),o(".dpc, .close_dpc_group","click",(function(e){if(e.classList.contains("opened")){document.querySelector('.dpc[data-type="'+e.dataset.type+'"]').classList.remove("opened"),document.querySelector('.close_dpc_group[data-type="'+e.dataset.type+'"]').classList.remove("opened");let t=document.querySelector('.data_processors_content[data-type="'+e.dataset.type+'"]');TweenMax.to(t,.5,{height:0})}else{document.querySelector('.dpc[data-type="'+e.dataset.type+'"]').classList.add("opened"),document.querySelector('.close_dpc_group[data-type="'+e.dataset.type+'"]').classList.add("opened");let t=document.querySelector('.data_processors_content[data-type="'+e.dataset.type+'"]');TweenMax.set(t,{height:"auto",display:"block"}),TweenMax.from(t,.5,{height:0})}})),o(".data_processors_content input, .data_processors_content select","input change",(function(e){let t=!1,o=e.closest(".data_processors_content");Array.from(o.querySelectorAll("input, select")).forEach((function(e){e.value&&""!=e.value.trim()&&0!=e.value&&(t=!0)})),t?document.querySelector('.dpc[data-type="'+o.dataset.type+'"]').classList.add("is_activated"):document.querySelector('.dpc[data-type="'+o.dataset.type+'"]').classList.remove("is_activated")})),o(".use_filters","click",(function(e){let o={};Array.from(document.querySelectorAll(".data_processors input, .data_processors select")).forEach((function(e){if(e.value&&""!=e.value.trim()&&0!=e.value){let r=e.value.trim();if(t.has(e,"Datepick")){let o=new Date(t.get(e,"Datepick").getDate("mm/dd/yyyy"));e.classList.contains("from")?(o.setHours(0,0,0,0),r=Math.ceil(o.getTime()/1e3)):(o.setHours(23,59,59,999),r=Math.floor(o.getTime()/1e3))}o[e.id]={value:r,type:e.dataset.filterType,operator:e.dataset.operator}}})),m({filters:o,page:1},!1)})),o(".load_more_records","click",(function(){m({filters:{},page:d},!0)})),o(document,"click",".admin_decline",(function(e){let t={id:e.dataset.id,new_status:"declined"},o=new s(t);r(".load_overlay"),fetch(status_ajax_url,{method:"POST",body:o,cache:"no-cache"}).then((e=>{if(!e.ok)throw new Error("Network response error");return e.json()})).then((e=>{a(".load_overlay"),document.querySelector(".use_filters").dispatchEvent(new Event("click"))})).catch((function(e){console.log(e)}))})),o(document,"click",".admin_refresh",(function(e){let t={id:e.dataset.id,new_status:"active"},o=new s(t);r(".load_overlay"),fetch(status_ajax_url,{method:"POST",body:o,cache:"no-cache"}).then((e=>{if(!e.ok)throw new Error("Network response error");return e.json()})).then((e=>{a(".load_overlay"),document.querySelector(".use_filters").dispatchEvent(new Event("click"))})).catch((function(e){console.log(e)}))}))}"undefined"==typeof pagetype||"booking new"!=pagetype&&"booking edit"!=pagetype||(p(),["#car_id","#use_rider","#status"].forEach((e=>new vanillaSelectBox(e,{maxSelect:1}))),Array.from(document.querySelectorAll(".datetime_picker")).forEach((e=>{let o=new Datepick(e,{language:"cs",autohide:!0});t.put(e,"Datepick",o)})),o("#date_from","changeDate",(function(e){t.get(document.querySelector("#date_to"),"Datepick").setOptions({minDate:new i(t.get(document.querySelector("#date_from"),"Datepick").getDate("mm/dd/yyyy")).addDays(1)});var o=new Event("input",{bubbles:!0,defaultPrevented:!0});e.dispatchEvent(o)})),o("#date_to","changeDate",(function(e){t.get(document.querySelector("#date_from"),"Datepick").setOptions({maxDate:new i(t.get(document.querySelector("#date_to"),"Datepick").getDate("mm/dd/yyyy")).addDays(-1)});var o=new Event("input",{bubbles:!0,defaultPrevented:!0});e.dispatchEvent(o)})),o("#use_rider, #car_id","change",(function(){p(),"undefined"!=typeof pagetype&&"booking new"==pagetype?u(!1,!0):u(!0,!0)})),o(".calculate_price","click",(function(){u(!0,!0)})),o("#mileage, #date_from, #date_to","changeDate input",(function(){"undefined"!=typeof pagetype&&"booking new"==pagetype?u(!1,!0):u(!0,!0)})),o(document,"input change",".red_error",(function(e){e.classList.remove("red_error"),e.closest(".js_parent").querySelector(".this_element_name").classList.remove("red_error")})),o(".create_order","click",(function(){f(!0)})),o(".save_booking","click",(function(){f(!1)})))}))}();